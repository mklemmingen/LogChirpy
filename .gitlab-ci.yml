variables:
  GIT_DEPTH: 0
  GIT_STRATEGY: clone

stages:
  - migrate

# Simple clone from GitLab and push to GitHub
migrate-to-github:
  stage: migrate
  image: alpine/git
  timeout: 1h
  script:
    
    - echo "Repository info:"
    - echo "Repository size:" 
    - du -sh .git | cut -f1
    - echo "Total commits:"
    - git rev-list --all --count
    - echo "Current branch:"
    - git branch --show-current || echo 'detached'
    
    - echo "Setting up GitHub remote..."
    - git remote remove origin 2>/dev/null || true
    - git remote remove github 2>/dev/null || true
    - git remote add github https://x-access-token:${GITHUB_TOKEN}@github.com/mklemmingen/LogChirpy.git
    
    - echo "Preparing for push..."
    - git checkout main 2>/dev/null || git checkout -b main
    
    - echo "Pushing to GitHub..."
    - git push --force github main
    
    - echo "Successfully migrated to GitHub!"

  only:
    - main
  when: manual
  environment: production